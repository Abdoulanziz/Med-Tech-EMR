<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Med Tech - EMR</title>


    <link rel="shortcut icon" href="/assets/svg/favicon.ico" type="image/x-icon"/>

    <link rel="stylesheet" href="/assets/css/utils.css">
    <link rel="stylesheet" href="/assets/css/admin.css">
    <link rel="stylesheet" href="/assets/css/table.min.css">
    <link rel="stylesheet" href="/assets/icons/themify-icons.css">

    <script src="/js/libraries/jquery-3.5.1.js"></script>
    <script src="/js/libraries/jquery.dataTables.min.js"></script>

    <script src="/js/libraries/chart.js"></script>
    <script src="/js/libraries/jspdf.min.js"></script>

</head>
<body>
    <div class="container-fluid">
        <div class="main">

            <!-- Sidebar -->
            <div class="sidebar">
                <div class="sidebar-logo">
                    <img src="/assets/svg/512x512.png" alt="" class="app-logo">
                    <span style="margin-inline-start: .6rem;color: #fff;font-family: 'Tilt Neon';font-weight: bolder;font-size: 27px;"><span style="color: rgb(0, 208, 255);">Med</span> <span style="color: yellowgreen;">Tech</span></span>
                </div>
                <ul class="sidebar-menu">
                    <li class="menu-item active">
                        <a href="/admin/dashboard">
                            <span class="flex">
                                <span class="flex"><img src="/assets/actions-admin/dashboard.svg" alt="" class="icon"><span class="text">Dashboard</span></span>
                            </span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="/admin/accounts">
                            <span class="flex">
                                <span class="flex"><img src="/assets/actions-admin/user.svg" alt="" class="icon"><span class="text">Users</span></span>
                            </span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="/admin/activities">
                            <span class="flex">
                                <span class="flex"><img src="/assets/actions-admin/activity.svg" alt="" class="icon"><span class="text">Activities</span></span>
                            </span>
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Main section -->
            <div class="content admin">

                <!-- Navbar -->
                <div class="navbar">
                    <nav>
                        <ul class="nav-links flex">
                            <img src="/assets/svg/cancel.png" alt="" id="sidebar-toggler" class="sidebar-toggler" style="block-size: 32px;inline-size: 32px;">
                            <div class="nav-badges flex">
                                <div class="user-badge flex">
                                    <h4 class="user-name"><%= data.user.username.charAt(0).toUpperCase() + data.user.username.slice(1) %></h4>
                                    <div class="user-avatar dropdown">
                                        <div class="dropdown-avatar flex">
                                            <img src="/assets/img/profiledefault.png" alt="user avatar" class="avatar">
                                            <i class="ti-angle-down" id="toggle-dropdown"></i>
                                        </div>
                                        <div class="dropdown-menu" id="dropdown-menu">
                                            <ul class="dropdown-items">
                                                <li class="dropdown-item header">
                                                    <span id="user-fullname-label"><%= data.user.username.charAt(0).toUpperCase() + data.user.username.slice(1) %></span>
                                                    <br>
                                                    <small id="user-email-label">admin@coire.live</small>
                                                </li>
                                                <li class="dropdown-item"><i class="ti-settings"></i> <a href="#">Settings</a></li>
                                                <li class="dropdown-item"><i class="ti-user"></i> <a href="#">My Profile</a></li>
                                                <li class="dropdown-item"><i class="ti-info-alt"></i> <a href="#">About</a></li>
                                                <li class="dropdown-item footer" id="signout-cta"><span>Sign Out</span></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </ul>
                    </nav>
                </div>

                <!-- Section 00 -->
                <div class="sections br-0 inview" id="section_00">
                    <div class="section-header">

                        <div class="section-header-top flex">
                            <h2 class="section-header-title">Dashboard</h2>
                        </div>

                        <div class="section-header-bottom">
                            <div class="section-togglers">
                                <span class="section-toggler active" data-section="section_00">General Insights</span>
                                <span class="section-toggler" data-section="section_01">Income</span>
                                <span class="section-toggler" data-section="section_02">Expenses</span>
                            </div>
                        </div>
                        
                    </div>
                    <div class="section-body" style="padding-block-start: .8rem;">

                        <div class="summary-cards">
                            <div class="summary-card blue card">
                                <div class="summary-content flex">
                                    <div class="summary-content-wrapper summary-content-wrapper-left">
                                        <h4>New Patients</h4>
                                        <h2 id="new-patients-count">0</h2>
                                    </div>
                                    <div class="summary-content-wrapper summary-content-wrapper-right">
                                        <span><i class="ti ti-money"></i></span>
                                    </div>
                                </div>
                                <div class="summary-metrics">
                                    <div class="summary-metrics-wrapper flex">
                                        <div class="summary-metrics-card">
                                            <span><i class="ti-arrow-up"></i></span>
                                            <span id="new-patients-percentage-count">56%</span>
                                        </div>
                                        <h4>Since last month</h4>
                                    </div>
                                </div>
                            </div>
                            <div class="summary-card yellow card">
                                <div class="summary-content flex">
                                    <div class="summary-content-wrapper summary-content-wrapper-left">
                                        <h4>Return Patients</h4>
                                        <h2 id="repeat-patients-count">0</h2>
                                    </div>
                                    <div class="summary-content-wrapper summary-content-wrapper-right">
                                        <span><i class="ti ti-user"></i></span>
                                    </div>
                                </div>
                                <div class="summary-metrics">
                                    <div class="summary-metrics-wrapper flex">
                                        <div class="summary-metrics-card">
                                            <span><i class="ti-arrow-up"></i></span>
                                            <span id="repeat-patients-percentage-count">56%</span>
                                        </div>
                                        <h4>Since last month</h4>
                                    </div>
                                </div>
                            </div>
                            <div class="summary-card orange card">
                                <div class="summary-content flex">
                                    <div class="summary-content-wrapper summary-content-wrapper-left">
                                        <h4>Income</h4>
                                        <h2 id="">UGX 14,000,000</h2>
                                    </div>
                                    <div class="summary-content-wrapper summary-content-wrapper-right">
                                        <span><i class="ti ti-time"></i></span>
                                    </div>
                                </div>
                                <div class="summary-metrics">
                                    <div class="summary-metrics-wrapper flex">
                                        <div class="summary-metrics-card">
                                            <span><i class="ti-arrow-up"></i></span>
                                            <span>56%</span>
                                        </div>
                                        <h4>Since last month</h4>
                                    </div>
                                </div>
                            </div>
                            <div class="summary-card green card">
                                <div class="summary-content flex">
                                    <div class="summary-content-wrapper summary-content-wrapper-left">
                                        <h4>Expenses</h4>
                                        <h2 id="">UGX 8,000,000</h2>
                                    </div>
                                    <div class="summary-content-wrapper summary-content-wrapper-right">
                                        <span><i class="ti ti-pencil"></i></span>
                                    </div>
                                </div>
                                <div class="summary-metrics">
                                    <div class="summary-metrics-wrapper flex">
                                        <div class="summary-metrics-card">
                                            <span><i class="ti-arrow-up"></i></span>
                                            <span>56%</span>
                                        </div>
                                        <h4>Since last month</h4>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="details-card">
                            <div class="details-card-header">
                                <h3 class="card-header">Metrics</h3>
                            </div>

                            <div class="details-card-body">
                                <div class="data-charts flex">
                                    <div class="data-chart card services-chart">
                                        <h3 id="chart-1-title" class="chart-title">Services</h3>

                                        <div class="filters">
                                            <div class="filters-wrapper">
                                                <i class="ti-filter filter-icon"></i>
                                                <div class="select-container">
                                                    <select class="filter-select" id="filter-select-left">
                                                        <option value="day">Today</option>
                                                        <option value="week">Week</option>
                                                        <option value="month">Month</option>
                                                        <option value="year">Year</option>
                                                    </select>
                                                    <div class="filter-select-icon">&#9660;</div>
                                                </div>
                                            </div>
                                            <div class="filters-ctas">
                                                <button id="print-data-graph" class="btn print-btn">Print <i class="ti ti-printer"></i></button>
                                            </div>
                                        </div>

                                        <canvas class="sales-chart" id="chart-1"></canvas>
                                    </div>

                                    <div class="data-chart card income-chart">
                                        <h3 id="chart-2-title" class="chart-title">Income</h3>

                                        <div class="filters">
                                            <div class="filters-wrapper">
                                                <i class="ti-filter filter-icon"></i>
                                                <div class="select-container">
                                                    <select class="filter-select" id="filter-select-right">
                                                        <option value="day">Today</option>
                                                        <option value="week">Week</option>
                                                        <option value="month">Month</option>
                                                        <option value="year">Year</option>
                                                    </select>
                                                    <div class="filter-select-icon">&#9660;</div>
                                                </div>
                                            </div>
                                            <div class="filters-ctas">
                                                <button id="print-data-graph" class="btn print-btn">Print <i class="ti ti-printer"></i></button>
                                            </div>
                                        </div>
                                        
                                        <canvas class="income-chart" id="chart-2"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section 01 -->
                <div class="sections br-0" id="section_01">
                    <div class="section-header">

                        <div class="section-header-top flex">
                            <h2 class="section-header-title">Dashboard</h2>
                        </div>

                        <div class="section-header-bottom">
                            <div class="section-togglers">
                                <span class="section-toggler" data-section="section_00">General Insights</span>
                                <span class="section-toggler active" data-section="section_01">Income</span>
                                <span class="section-toggler" data-section="section_02">Expenses</span>
                            </div>
                        </div>
                        
                    </div>
                    <div class="section-body" style="padding-block-start: .8rem;">
                        <div class="details-card">
                            <div class="details-card-header">
                                <h3 class="card-header">Income Details</h3>
                            </div>

                            <div class="details-card-body">
                                <div class="filter-section">
                                    <div class="filters">
                                        <div class="filters-wrapper">
                                            <i class="ti-filter filter-icon"></i>
                                            <div class="date-range-picker flex">
                                                <div class="form-group flex">
                                                    <label for="min-date">From:</label>
                                                    <input type="date" name="from" id="min-date" class="date-range-filter">
                                                </div>
                                                <div class="form-group flex">
                                                    <label for="max-date">To:</label>
                                                    <input type="date" name="to" id="max-date" class="date-range-filter">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="filters-ctas">
                                            <img src="/assets/filters-ctas/pdf.png" alt="pdf icon" title="Download as PDF">
                                            <img src="/assets/filters-ctas/csv.png" alt="csv icon" title="Download as CSV">
                                            <img src="/assets/filters-ctas/xls.png" alt="xls icon" title="Download as XLS">
                                            <img src="/assets/filters-ctas/printer.png" alt="printer icon" title="Print">
                                        </div>

                                    </div>
                                </div>
                                <table id="income-table" class="display" style="width:100%;margin-top:.5rem;">
                                    <thead>
                                        <tr>
                                            <th>Income ID</th>
                                            <th>Payment Method</th>
                                            <th>Amount</th>
                                            <th>Description</th>
                                            <th>Created At</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section 02 -->
                <div class="sections br-0" id="section_02">
                    <div class="section-header">

                        <div class="section-header-top flex">
                            <h2 class="section-header-title">Dashboard</h2>
                            <div class="ctas">
                                <button class="btn section-header-cta modal-trigger" id="open-create-expense-record-modal-btn" data-modal="create-expense-record-modal"> <i class="ti-plus"></i> New Expense</button>
                            </div>
                        </div>

                        <div class="section-header-bottom">
                            <div class="section-togglers">
                                <span class="section-toggler" data-section="section_00">General Insights</span>
                                <span class="section-toggler" data-section="section_01">Income</span>
                                <span class="section-toggler active" data-section="section_02">Expenses</span>
                            </div>
                        </div>
                        
                    </div>
                    <div class="section-body" style="padding-block-start: .8rem;">
                        <div class="details-card">
                            <div class="details-card-header">
                                <h3 class="card-header">Expense Details</h3>
                            </div>

                            <div class="details-card-body">
                                <div class="filter-section">
                                    <div class="filters">
                                        <div class="filters-wrapper">
                                            <i class="ti-filter filter-icon"></i>
                                            <div class="date-range-picker flex">
                                                <div class="form-group flex">
                                                    <label for="min-date">From:</label>
                                                    <input type="date" name="from" id="min-date" class="date-range-filter">
                                                </div>
                                                <div class="form-group flex">
                                                    <label for="max-date">To:</label>
                                                    <input type="date" name="to" id="max-date" class="date-range-filter">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="filters-ctas">
                                            <img src="/assets/filters-ctas/pdf.png" alt="pdf icon" title="Download as PDF">
                                            <img src="/assets/filters-ctas/csv.png" alt="csv icon" title="Download as CSV">
                                            <img src="/assets/filters-ctas/xls.png" alt="xls icon" title="Download as XLS">
                                            <img src="/assets/filters-ctas/printer.png" alt="printer icon" title="Print">
                                        </div>
                                    </div>
                                </div>
                                <table id="expenses-table" class="display" style="width:100%;margin-top:.5rem;">
                                    <thead>
                                        <tr>
                                            <th>Expense ID</th>
                                            <th>Category</th>
                                            <th>Amount</th>
                                            <th>Description</th>
                                            <th>Payment Method</th>
                                            <th>Created At</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bottom banner -->
                <div class="bottom-banner">
                    <div class="banner-content">
                        <div class="banner-content-left">
                            <span class="logged-in-as-label">Logged in as: <span class="logged-in-as-value"> <%= data.user.username.charAt(0).toUpperCase() + data.user.username.slice(1) %> </span></span>
                        </div>
                        <div class="banner-content-right">
                            <span class="system-version-label">System version: <span class="system-version-value"> 1.0.0 </span></span>
                        </div>
                    </div>
                </div>

                <!-- Create expense modal -->
                <div id="create-expense-record-modal" class="form-modal">
                    <div class="form-modal-content">
                        <form class="modal-form" id="create-expense-record-form">
                            <div class="form-modal-header flex">
                                <div class="form-modal-header-left flex">
                                <img src="/assets/actions-admin/user.png" alt="" class="icon">
                                    <h2 class="title">Create Expense Record</h2>
                                </div>
                                <span class="form-modal-header-right icon-wrapper close-modal-btn"><i class="ti-close icon"></i></span>
                            </div>
                
                            <div class="modal-form-body" id="">
                                <div class="form-section">
                                    <h2>Information</h2>

                                    <div class="form-group">
                                        <label for="expense-category">Expense Category:</label>
                                        <select id="expense-category" class="form-control" name="expenseCategory" required>
                                            <option value="utilities">Utilities</option>
                                            <option value="rent">Rent</option>
                                            <option value="others">Others</option>
                                        </select>
                                    </div>
        
                                    <div class="form-group">
                                        <label for="amount">Amount:</label>
                                        <input type="text" class="form-control" id="amount" name="amount" required>
                                    </div>

                                    <div class="form-group">
                                        <label for="payment-method">Payment Method:</label>
                                        <select id="payment-method" class="form-control" name="paymentMethod" required>
                                            <option value="cash">Cash</option>
                                            <option value="insurance">Insurance</option>
                                            <option value="account">Account</option>
                                        </select>
                                    </div>
                                
                                    <div class="form-group">
                                        <label for="narration">Narration:</label>
                                        <textarea id="narration" class="form-control" name="narration"></textarea>
                                    </div>
            
                                </div>
                            </div>
                
                            <div class="form-modal-footer flex">
                                <button class="btn btn-primary" type="button">Cancel</button>
                                <button class="btn btn-primary btn-save submit-btn" type="submit">Save</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/libraries/moment.min.js"></script>
    <script src="/js/tinymce/js/tinymce/tinymce.min.js"></script>

    <!-- Load modules -->
    <script type="module" src="/js/core/ui.js"></script>
    <script type="module" src="/js/modules/dashboard.js"></script>
   
    <script>
        document.addEventListener('DOMContentLoaded', ()=>{

            let chartTitle1 = document.querySelector('#chart-1-title');
            let chartTitle2 = document.querySelector('#chart-2-title');
            chartTitle1.textContent = "Week's Services";
            chartTitle2.textContent = "Week's Income";

            mChart1 = createChart('Days',
            'bar',
            ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            [80, 100, 46, 39, 57, 25, 66],
            'chart-1'
            );

            mChart2 = createChart('Days',
            'line',
            ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            [80000, 1000000, 460000, 0, 5700000, 0, 0],
            'chart-2'
            );

            const filterSelectLeft = document.querySelector("#filter-select-left");
            filterSelectLeft.addEventListener("change", event => {
                const selectedFilter = event.target.value;
                if(selectedFilter === "day"){
                    chartTitle1.textContent = "Day's Services";

                    mChart1.destroy();
                    mChart1 = createChart('Durations',
                    'bar',
                    ['Morning', 'Afternoon', 'Eevening'],
                    [80, 100, 46],
                    'chart-1'
                    );
                    
                }else if(selectedFilter === "week"){

                    chartTitle1.textContent = "Week's Services";

                    mChart1.destroy();
                    mChart1 = createChart('Days',
                    'bar',
                    ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    [80, 100, 46, 39, 57, 25, 66],
                    'chart-1'
                    );

                }else if(selectedFilter === "month"){

                    chartTitle1.textContent = "Month's Services";

                    mChart1.destroy();
                    mChart1 = createChart('Weeks',
                    'bar',
                    ['Week1', 'Week2', 'Week3','Week4'],
                    [80, 100, 46, 39],
                    'chart-1'
                    );

                }else if(selectedFilter === "year"){

                    chartTitle1.textContent = "Year's Services";

                    mChart1.destroy();
                    mChart1 = createChart('Months',
                    'bar',
                    ['Quarter1', 'Quarter2', 'Quarter3', 'Quarter4'],
                    [80, 46, 39, 60],
                    'chart-1'
                    );
                }
                
            });

            const filterSelectRight = document.querySelector("#filter-select-right");
            filterSelectRight.addEventListener("change", event => {
                const selectedFilter = event.target.value;
                if(selectedFilter === "day"){
                    chartTitle2.textContent = "Day's Income";

                    mChart2.destroy();
                    mChart2 = createChart('Durations',
                    'line',
                    ['Morning', 'Afternoon', 'Eevening'],
                    [80000, 1000000, 460000],
                    'chart-2'
                    );
                    
                }else if(selectedFilter === "week"){

                    chartTitle2.textContent = "Week's Income";

                    mChart2.destroy();
                    mChart2 = createChart('Days',
                    'line',
                    ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    [80000, 1000000, 460000, 0, 5700000, 0, 0],
                    'chart-2'
                    );

                }else if(selectedFilter === "month"){

                    chartTitle2.textContent = "Month's Income";

                    mChart2.destroy();
                    mChart2 = createChart('Weeks',
                    'line',
                    ['Week1', 'Week2', 'Week3','Week4'],
                    [80000, 1000000, 460000, 5700000],
                    'chart-2'
                    );

                }else if(selectedFilter === "year"){

                    chartTitle2.textContent = "Year's Income";

                    mChart2.destroy();
                    mChart2 = createChart('Months',
                    'line',
                    ['Quarter1', 'Quarter2', 'Quarter3', 'Quarter4'],
                    [80000, 1000000, 5700000, 7000000],
                    'chart-2'
                    );
                }
                
            });
        });



        // Charts
        function createChart(title='', type='bar', labels=[], mdata=[], canvasId){
            if(labels.length == 0 && mdata.length == 0) return;
            
            const data = {
            labels: labels,
            datasets: [{
                label: title,
                backgroundColor: '#b297f1',
                borderColor: '#b297f1',
                data: mdata,
            }]
            };

            const config = {
            type: type,
            data: data,
            options: {
                scales: {
                    y: {
                        startAtZero: true
                    }
                }
            }
            };

            // Render chart
            const myChart = new Chart(
                document.getElementById(canvasId),
                config
            );
            return myChart;
        }

        

        function printDataGraph() {
            var canvas = document.querySelector("#chart-1");
            var canvas_img = canvas.toDataURL("image/png",1.0);
            var pdf = new jsPDF('landscape','in', 'letter');
            pdf.addImage(canvas_img, 'png', .5, 1.75, 10, 5);
            pdf.autoPrint();
            var blob = pdf.output("bloburl");
            window.open(blob);
        }

        document.querySelector("#print-data-graph").addEventListener('click', ()=> {
            printDataGraph();
        });

        
    </script>
</body>
</html>